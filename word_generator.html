<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Renole Engelang - Word generator</title>
    <link rel="stylesheet" href="/styles/index.css" />
  </head>
  <body>
    <a href="/">Go back to title page.</a>
    <h2>Word generator</h2>
    It is hard to come up with words. You can use this page to generate words
    and pronounciations.
    <form id="generator">
      <input
        type="number"
        name="seed"
        placeholder="Seed (blank for random)"
        max="4294967295"
        min="0"
      /><label
        ><input type="checkbox" name="reseed" /> New seed every
        generation</label
      ><br />
      <input type="button" name="generate" value="Generate" /><br />
      <input
        type="text"
        name="result"
        readonly
        placeholder="Result"
        onClick="this.setSelectionRange(0, this.value.length)"
      />
      <input
        type="text"
        name="escaped"
        readonly
        placeholder="Result (escaped)"
        onClick="this.setSelectionRange(0, this.value.length)"
      />
      <input
        type="text"
        name="pronounciation"
        readonly
        placeholder="Pronounciation"
        onClick="this.setSelectionRange(0, this.value.length)"
      />
      <input type="button" name="copy" value="Copy as &lt;tr&gt;" /><br />
    </form>

    <script>
      const form = document.querySelector("form#generator");
      form.querySelector(`[name="seed"]`).value = jsRandomInt(0, 4294967295);
      const sounds = {
        "<": {
          escape: "&gt;",
          consonant: "ʃ",
          vowels: {
            "<": "i",
            ">": "y",
            "^": "ɘ",
            v: "ʊ",
          },
        },
        ">": {
          escape: "&lt;",
          consonant: "ʒ",
          vowels: {
            "<": "æ",
            ">": "ɤ̞",
            "^": "o̞",
            v: null,
          },
        },
        "^": {
          escape: "^",
          consonant: "k",
          vowels: {
            "<": null,
            ">": null,
            "^": "ɶ",
            v: "ɒ",
          },
        },
        v: {
          escape: "v",
          consonant: "ɡ",
          vowels: {
            "<": null,
            ">": null,
            "^": null,
            v: "ɛ",
          },
        },
      };
      const validPairs = (() => {
        const pairs = [];
        for (const first of Object.keys(sounds)) {
          for (const second of Object.entries(sounds[first].vowels)
            .filter((x) => x[1] !== null)
            .map((x) => x[0])) {
            pairs.push(`${first}${second}`);
          }
        }
        return pairs;
      })();
      function mulberry32(a) {
        return function () {
          var t = (a += 0x6d2b79f5);
          t = Math.imul(t ^ (t >>> 15), t | 1);
          t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
        };
      }
      function jsRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min)) + min;
      }
      function generateWord(
        seed = +form.querySelector(`[name="seed"]`).value ||
          jsRandomInt(0, 4294967295)
      ) {
        const random = mulberry32(seed);
        const length = Math.floor(10 * random()) + 1;
        let word = "";
        for (const i of Array(length).keys()) {
          word += validPairs[Math.floor(validPairs.length * random())];
        }
        return word;
      }
      /**
       * @param {string} pair
       */
      function pairPronounciation(pair) {
        if (pair.length == 1) {
          return sounds[pair].consonant;
        } else if (pair.length == 2) {
          return sounds[pair[0]].consonant + sounds[pair[0]].vowels[pair[1]];
        }
        return null;
      }
      /**
       * @param {string} word
       */
      function wordPronounciation(
        word = form.querySelector(`[name="result"]`).value
      ) {
        const pairs = [];
        let pair = "";
        let secondLetter = false;
        for (const char of word) {
          if (!secondLetter) {
            pair = char;
            secondLetter = true;
          } else {
            pair += char;
            pairs.push(pair);
            secondLetter = false;
          }
        }
        if (pair.length == 1) {
          pairs.push(pair);
        }
        return pairs.map(pairPronounciation).join("");
      }

      /**
       * @param {string} word
       */
      function escapeWord(word = form.querySelector(`[name="result"]`).value) {
        return word
          .split("")
          .map((x) => sounds[x].escape)
          .join("");
      }

      form.querySelector(`[name="generate"]`).addEventListener("click", () => {
        const word = generateWord();
        form.querySelector(`[name="result"]`).value = word;
        const escaped = escapeWord();
        form.querySelector(`[name="escaped"]`).value = escaped;
        const pronounciation = wordPronounciation();
        form.querySelector(`[name="pronounciation"]`).value = pronounciation;
        if (form.querySelector(`[name="reseed"]`).checked)
          form.querySelector(`[name="seed"]`).value = jsRandomInt(
            0,
            4294967295
          );
      });

      form.querySelector(`[name="copy"]`).addEventListener("click", () => {
        const escaped = form.querySelector(`[name="escaped"]`).value;
        const pronounciation = form.querySelector(`[name="pronounciation"]`).value;
        navigator.clipboard.writeText(`
          <tr>
            <td>${escaped}</td>
            <td>${pronounciation}</td>
            <td><i>Untranslated</i></td>
          </tr>
        `)
      });
    </script>
  </body>
</html>
